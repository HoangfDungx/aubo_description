<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:macro name="aubo_ros2_control" params="name prefix use_fake_hardware:=false robot_ip">
    <ros2_control name="${name}" type="system">

      <xacro:if value="${use_fake_hardware}">
        <!-- Gazebo Harmonic (gz) control plugin -->
        <hardware>
          <plugin>gz_ros2_control/GazeboSimSystem</plugin>
        </hardware>
      </xacro:if>

      <xacro:unless value="${use_fake_hardware}">
        <!-- Physical hardware -->
        <hardware>
          <plugin>aubo_driver/AuboHardwareInterface</plugin>
          <param name="robot_ip">${robot_ip}</param>
        </hardware>
      </xacro:unless>

      <!-- Joint definitions -->
      <joint name="shoulder_joint">
        <command_interface name="position">
          <param name="min">-6.284</param>
          <param name="max">6.284</param>
        </command_interface>
        <command_interface name="velocity" />
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity" />
      </joint>

      <joint name="upperArm_joint">
        <command_interface name="position">
          <param name="min">-6.284</param>
          <param name="max">6.284</param>
        </command_interface>
        <command_interface name="velocity" />
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity" />
      </joint>

      <joint name="foreArm_joint">
        <command_interface name="position">
          <param name="min">-2.41</param>
          <param name="max">2.41</param>
        </command_interface>
        <command_interface name="velocity" />
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity" />
      </joint>

      <joint name="wrist1_joint">
        <command_interface name="position">
          <param name="min">-2.66</param>
          <param name="max">2.66</param>
        </command_interface>
        <command_interface name="velocity" />
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity" />
      </joint>

      <joint name="wrist2_joint">
        <command_interface name="position">
          <param name="min">-6.284</param>
          <param name="max">6.284</param>
        </command_interface>
        <command_interface name="velocity" />
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity" />
      </joint>

      <joint name="wrist3_joint">
        <command_interface name="position">
          <param name="min">-2.23</param>
          <param name="max">2.23</param>
        </command_interface>
        <command_interface name="velocity" />
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity" />
      </joint>

    </ros2_control>

    <xacro:if value="${use_fake_hardware}">
      <gazebo>
        <plugin filename="libgz_ros2_control-system.so"
          name="gz_ros2_control::GazeboSimROS2ControlPlugin">
          <ros>
            <namespace>${prefix}</namespace>
          </ros>
          <parameters>$(find aubo_gazebo)/config/aubo_controllers.yaml</parameters>
          <controller_manager_name>controller_manager</controller_manager_name>
        </plugin>

        <plugin
          filename="gz-sim-joint-state-publisher-system"
          name="gz::sim::systems::JointStatePublisher">
          <topic>joint_states</topic>
        </plugin>
      </gazebo>
    </xacro:if>
  </xacro:macro>

</robot>